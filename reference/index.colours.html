<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Converts an image represented by a grDevices raster object into a
matrix containing numeric indices of a quantised colour palette."><title>Quantisation of colours and indexing a grDevices raster image — index.colours • AmigaFFH</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Quantisation of colours and indexing a grDevices raster image — index.colours"><meta property="og:description" content="Converts an image represented by a grDevices raster object into a
matrix containing numeric indices of a quantised colour palette."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">AmigaFFH</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../reference/AmigaFFH-package.html">Package documentation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/pepijn-devries/AmigaFFH/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Quantisation of colours and indexing a grDevices raster image</h1>
      <small class="dont-index">Source: <a href="https://github.com/pepijn-devries/AmigaFFH/blob/HEAD/R/generic_support.r" class="external-link"><code>R/generic_support.r</code></a></small>
      <div class="d-none name"><code>index.colours.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Converts an image represented by a grDevices <code>raster</code> object into a
matrix containing numeric indices of a quantised colour palette.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">index.colours</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  length.out <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  palette <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  background <span class="op">=</span> <span class="st">"#FFFFFF"</span>,</span>
<span>  dither <span class="op">=</span> <span class="fu"><a href="c.html">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"floyd-steinberg"</span>, <span class="st">"JJN"</span>, <span class="st">"stucki"</span>, <span class="st">"atkinson"</span>, <span class="st">"burkse"</span>, <span class="st">"sierra"</span>,</span>
<span>    <span class="st">"two-row-sierra"</span>, <span class="st">"sierra-lite"</span><span class="op">)</span>,</span>
<span>  colour.depth <span class="op">=</span> <span class="fu"><a href="c.html">c</a></span><span class="op">(</span><span class="st">"12 bit"</span>, <span class="st">"24 bit"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p>A raster object (<code><a href="https://rdrr.io/r/grDevices/as.raster.html" class="external-link">grDevices::as.raster()</a></code>), or a <code>matrix</code>
containing <code>character</code> strings representing colours. <code>x</code> can also
be a <code>list</code> of such matrices or rasters. All elements of this list should
have identical dimensions. An overall palette will be generated for elements in the
list.</p></dd>


<dt>length.out</dt>
<dd><p>A <code>numeric</code> value indicating the number of desired
colours in the indexed palette.</p>
<p>It can also be a <code>character</code> string indicating which special
Amiga display mode should be used when indexing colours.
‘<code>HAM6</code>’ and ‘<code>HAM8</code>’ are supported.
See <code><a href="rasterToBitmap.html">rasterToBitmap()</a></code> for more details on these
special modes.</p></dd>


<dt>palette</dt>
<dd><p>A vector of no more than <code>length.out</code> colours, to be used
for the bitmap image. When missing or set to <code>NULL</code>, a palette will be
generated based on the provided colours in raster <code>x</code>. In that case,
<code><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">stats::kmeans()</a></code> is used on the hue, saturation, brightness and
alpha values of the colours in <code>x</code> for clustering the colours. The cluster
centres will be used as palette colours.</p></dd>


<dt>background</dt>
<dd><p>On the Amiga, indexed images could not be semi-transparent.
Only a single colour could be designated as being fully transparent. The
``background`' argument should contain a background colour with which
semi-transparent colours should be mixed, before colour quantisation. It is
white by default.</p></dd>


<dt>dither</dt>
<dd><p>Dither the output image using the algorithm specified here.
See the usage section for possible options. By default no dithering ("<code>none</code>")
is applied. See <code><a href="dither.html">dither()</a></code> for more details.</p></dd>


<dt>colour.depth</dt>
<dd><p>A <code>character</code> string indicating the colour depth to be used.
Can be either "<code>12 bit</code>" (default, standard on an Amiga with original chipset),
or "<code>24 bit</code>".</p>
<p>This argument is overruled when <code>length.out</code> is set to “<code>HAM6</code>”
or “<code>HAM8</code>”. In that case the colour depth linked to that special mode
is used (12 bit for HAM6, 24 bit for HAM8).</p></dd>


<dt>...</dt>
<dd><p>Arguments that are passed onto <code><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">stats::kmeans()</a></code> (see
<code>palette</code> argument).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Returns a <code>matrix</code> with the same dimensions as <code>x</code> containing
<code>numeric</code> index values. The corresponding palette is returned as attribute,
as well as the index value for the fully transparent colour in the palette.
When <code>x</code> is a <code>list</code> a <code>list</code> of matrices is returned.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Determines the optimal limited palette by clustering colours in an image
with <code><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">stats::kmeans()</a></code>. The result of the optimisation routine
will depend on the randomly chosen cluster centres by this algorithm. This
means that the result may slightly differ for each call to this function. If
you want reproducible results, you may want to reset the random seed
(<code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code>) before each call to this function.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other colour.quantisation.operations: 
<code><a href="dither.html">dither</a>()</code></p>
<p>Other raster.operations: 
<code><a href="AmigaBitmapFont.html">AmigaBitmapFont</a></code>,
<code><a href="as.raster.html">as.raster.AmigaBasicShape</a>()</code>,
<code><a href="bitmapToRaster.html">bitmapToRaster</a>()</code>,
<code><a href="dither.html">dither</a>()</code>,
<code><a href="rasterToAmigaBasicShape.html">rasterToAmigaBasicShape</a>()</code>,
<code><a href="rasterToAmigaBitmapFont.html">rasterToAmigaBitmapFont</a>()</code>,
<code><a href="rasterToBitmap.html">rasterToBitmap</a>()</code>,
<code><a href="rasterToHWSprite.html">rasterToHWSprite</a>()</code>,
<code><a href="rasterToIFF.html">rasterToIFF</a>()</code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Pepijn de Vries</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">## first: Let's make a raster out of the 'volcano' data, which we can use in the example:</span></span></span>
<span class="r-in"><span><span class="va">volcano.raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="as.raster.html">as.raster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">terrain.colors</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">volcano</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="va">volcano</span> <span class="op">-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">volcano</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">volcano</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## This will create an image of the original raster using an indexed palette:</span></span></span>
<span class="r-in"><span><span class="va">volcano.index</span> <span class="op">&lt;-</span> <span class="fu">index.colours</span><span class="op">(</span><span class="va">volcano.raster</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The index values can be converted back into colours, using the palette:</span></span></span>
<span class="r-in"><span><span class="va">volcano.index</span> <span class="op">&lt;-</span> <span class="fu"><a href="as.raster.html">as.raster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">volcano.index</span>, <span class="fl">2</span>,</span></span>
<span class="r-in"><span>                                 <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">volcano.index</span><span class="op">)</span><span class="op">$</span><span class="va">palette</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Create an indexed image using dithering</span></span></span>
<span class="r-in"><span><span class="va">volcano.dith</span> <span class="op">&lt;-</span> <span class="fu">index.colours</span><span class="op">(</span><span class="va">volcano.raster</span>, dither <span class="op">=</span> <span class="st">"floyd-steinberg"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">volcano.dith</span> <span class="op">&lt;-</span> <span class="fu"><a href="as.raster.html">as.raster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">volcano.dith</span>, <span class="fl">2</span>,</span></span>
<span class="r-in"><span>                                <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">volcano.dith</span><span class="op">)</span><span class="op">$</span><span class="va">palette</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## plot the images side by side for comparison</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfcol <span class="op">=</span> <span class="fu"><a href="c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">volcano.raster</span>, interpolate <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">volcano.index</span>, interpolate <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">volcano.dith</span>, interpolate <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Pepijn de Vries.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

